{% load static %}

<div class="card shadow-sm">
    <a href="{% url 'storefront:product' product.slug %}" class="text-decoration-none">
        <div class="position-relative">
            {% if product.imagen %}
            <img src="{{ product.imagen.url }}" class="card-img-top" alt="{{ product.nombre }}">
            {% else %}
            <img src="{% static 'img/no-image.png' %}" class="card-img-top" alt="No imagen">
            {% endif %}
            
            {% if product.descuento > 0 %}
            <div class="position-absolute top-0 start-0 m-3">
                <span class="badge bg-danger">-{{ product.descuento }}%</span>
            </div>
            {% endif %}
        </div>
        
        <div class="card-body d-flex flex-column" style="min-height: 180px; padding-bottom: 80px;">
            <h5 class="card-title text-dark mb-2" style="height: 2.4rem; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">{{ product.nombre }}</h5>
            <p class="card-text text-muted small mb-1">{{ product.categoria.nombre }}</p>
            <p class="card-text text-muted small mb-2" style="height: 2.4rem; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">
                {{ product.descripcion|truncatechars:80 }}
            </p>
            
            <div class="mt-2">
                <div class="mb-2">
                    {% if product.descuento > 0 %}
                    <span class="text-decoration-line-through text-muted me-2 fs-6">${{ product.precio_original }}</span>
                    {% endif %}
                    <span class="text-primary fw-bold h4 mb-0 d-block">${{ product.precio }}</span>
                </div>
                
                <div class="stock-info">
                    {% if product.stock > 0 %}
                    <span class="badge bg-success">En Stock</span>
                    {% else %}
                    <span class="badge bg-danger">Agotado</span>
                    {% endif %}
                </div>
            </div>
        </div>
    </a>
    {% if product.descuento > 0 %}
    <div class="position-absolute top-0 start-0 p-2">
        <span class="badge bg-danger">-{{ product.descuento }}%</span>
    </div>
    {% endif %}

    {% if product.stock > 0 %}
    <div class="position-absolute bottom-0 start-0 end-0 p-3 bg-white border-top" style="z-index: 2;">
        <form class="d-flex gap-2 cart-add-form" data-product-id="{{ product.id }}" onsubmit="return false;">
            {% csrf_token %}
            <input type="number" name="quantity" value="1" min="1" max="{{ product.stock }}" 
                   class="form-control form-control-sm" style="width: 70px">
            <button type="button" class="btn btn-primary flex-grow-1 add-to-cart-btn">
                <i class="fas fa-cart-plus"></i> Agregar
            </button>
        </form>
    </div>
    {% else %}
    <div class="position-absolute bottom-0 start-0 end-0 p-3 bg-white border-top">
        <button class="btn btn-secondary w-100" disabled>
            Agotado
        </button>
    </div>
    {% endif %}
</div>