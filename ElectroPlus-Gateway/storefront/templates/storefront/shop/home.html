{% extends "storefront/base/base.html" %}
{% load static %}

{% block title %}ElectroPlus - Tu tienda de electrónica{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero bg-primary text-white py-5 mb-4">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-6">
                <h1 class="display-4 fw-bold">Bienvenido a ElectroPlus</h1>
                <p class="lead">Tu tienda de confianza para productos electrónicos de calidad</p>
                <a href="#productos" class="btn btn-light btn-lg">Ver Productos</a>
            </div>
            <div class="col-md-6 text-center">
                <i class="fas fa-laptop-code fa-10x text-white-50"></i>
            </div>
        </div>
    </div>
</section>

<!-- Featured Categories -->
<section class="categories mb-5">
    <div class="container">
        <h2 class="text-center mb-4">Categorías Destacadas</h2>
        {% if error %}
        <div class="alert alert-warning text-center">
            <i class="fas fa-exclamation-triangle me-2"></i>
            No se pudieron cargar las categorías. Por favor, intente recargar la página.
        </div>
        {% else %}
        <div class="row g-4">
            {% for category in categories %}
            <div class="col-6 col-md-3">
                <a href="{% url 'storefront:category' slug=category.slug %}" class="text-decoration-none">
                    <div class="card h-100 category-card border-0 shadow-sm">
                        {% if category.imagen %}
                        <img src="{{ category.imagen }}" class="card-img-top" alt="{{ category.nombre }}" style="height: 150px; object-fit: cover;">
                        {% else %}
                        <div class="card-img-top bg-light text-center py-4" style="height: 150px;">
                            <i class="fas fa-folder fa-3x text-primary"></i>
                        </div>
                        {% endif %}
                        <div class="card-body text-center">
                            <h5 class="card-title text-dark mb-0">{{ category.nombre }}</h5>
                            {% if category.descripcion %}
                            <p class="card-text small text-muted mt-2">{{ category.descripcion|truncatechars:50 }}</p>
                            {% endif %}
                        </div>
                    </div>
                </a>
            </div>
            {% endfor %}
        </div>
        {% endif %}
    </div>
</section>

<!-- Products Section -->
<section id="productos" class="products mb-5">
    <div class="container">
        <div class="row mb-4">
            <div class="col-md-6">
                <h2>Nuestros Productos</h2>
            </div>
            <div class="col-md-6 text-md-end">
                <div class="btn-group">
                    <button type="button" class="btn btn-outline-primary dropdown-toggle" data-bs-toggle="dropdown">
                        Ordenar por
                    </button>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item {% if active_sort == 'price_low' %}active{% endif %}" 
                           href="?{% if category %}category={{ category }}&{% endif %}{% if search_query %}search={{ search_query }}&{% endif %}sort=price_low">Precio: Menor a Mayor</a></li>
                        <li><a class="dropdown-item {% if active_sort == 'price_high' %}active{% endif %}"
                           href="?{% if category %}category={{ category }}&{% endif %}{% if search_query %}search={{ search_query }}&{% endif %}sort=price_high">Precio: Mayor a Menor</a></li>
                        <li><a class="dropdown-item {% if active_sort == 'name' %}active{% endif %}"
                           href="?{% if category %}category={{ category }}&{% endif %}{% if search_query %}search={{ search_query }}&{% endif %}sort=name">Nombre</a></li>
                    </ul>
                </div>
            </div>
        </div>

        {% if error %}
        <div class="alert alert-warning text-center">
            <i class="fas fa-exclamation-triangle me-2"></i>
            No se pudieron cargar los productos. Por favor, intente recargar la página.
        </div>
        {% else %}
        <div class="row g-4">
            {% for product in products %}
            <div class="col-6 col-md-4 col-lg-3">
                <div class="card h-100 product-card position-relative">
                    <a href="{% url 'storefront:product' product.slug %}" class="text-decoration-none stretched-link">
                        {% if product.imagen %}
                        <img src="{{ product.imagen }}" class="card-img-top" alt="{{ product.nombre }}" style="height: 200px; object-fit: cover;">
                        {% else %}
                        <div class="card-img-top bg-light text-center py-4" style="height: 200px;">
                            <i class="fas fa-box fa-3x text-primary"></i>
                        </div>
                        {% endif %}
                        <div class="card-body">
                            <h5 class="card-title text-dark text-truncate">{{ product.nombre }}</h5>
                            <p class="card-text text-muted text-truncate-2">{{ product.descripcion }}</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    {% if product.descuento > 0 %}
                                    <span class="h5 mb-0 text-primary">${{ product.precio }}</span>
                                    <small class="text-muted text-decoration-line-through ms-2">${{ product.precio_original }}</small>
                                    {% else %}
                                    <span class="h5 mb-0">${{ product.precio }}</span>
                                    {% endif %}
                                </div>
                                <div class="position-relative" style="z-index: 2;">
                                    <button onclick="event.preventDefault(); event.stopPropagation(); addToCart({{ product.id }})" 
                                            class="btn btn-primary btn-sm"
                                            data-bs-toggle="tooltip" 
                                            data-bs-placement="top" 
                                            title="Añadir al carrito">
                                        <i class="fas fa-cart-plus"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </a>
                    {% if product.descuento > 0 %}
                    <div class="position-absolute top-0 start-0 p-2">
                        <span class="badge bg-danger">-{{ product.descuento }}%</span>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% empty %}
            <div class="col-12">
                <div class="alert alert-info text-center">
                    No se encontraron productos que coincidan con su búsqueda.
                </div>
            </div>
            {% endfor %}
        </div>

        {% if products.paginator.num_pages > 1 %}
        <nav class="mt-4">
            <ul class="pagination justify-content-center">
                {% if products.has_previous %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ products.previous_page_number }}{% if active_sort %}&sort={{ active_sort }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}">
                        <i class="fas fa-chevron-left"></i>
                    </a>
                </li>
                {% endif %}
                
                {% for num in products.paginator.page_range %}
                <li class="page-item {% if num == products.number %}active{% endif %}">
                    <a class="page-link" href="?page={{ num }}{% if active_sort %}&sort={{ active_sort }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}">
                        {{ num }}
                    </a>
                </li>
                {% endfor %}
                
                {% if products.has_next %}
                <li class="page-item">
                    <a class="page-link" href="?page={{ products.next_page_number }}{% if active_sort %}&sort={{ active_sort }}{% endif %}{% if search_query %}&search={{ search_query }}{% endif %}">
                        <i class="fas fa-chevron-right"></i>
                    </a>
                </li>
                {% endif %}
            </ul>
        </nav>
        {% endif %}
        {% endif %}
    </div>
</section>

<!-- Cart Toast Notification -->
<div class="toast-container position-fixed bottom-0 end-0 p-3">
    <div id="cartToast" class="toast" role="alert">
        <div class="toast-header">
            <i class="fas fa-shopping-cart text-primary me-2"></i>
            <strong class="me-auto">Carrito</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
        </div>
        <div class="toast-body">
            Producto añadido al carrito exitosamente.
        </div>
    </div>
    <div id="errorToast" class="toast" role="alert">
        <div class="toast-header bg-danger text-white">
            <i class="fas fa-exclamation-circle me-2"></i>
            <strong class="me-auto">Error</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
        </div>
        <div class="toast-body">
            No se pudo añadir el producto al carrito.
        </div>
    </div>
</div>
{% endblock %}