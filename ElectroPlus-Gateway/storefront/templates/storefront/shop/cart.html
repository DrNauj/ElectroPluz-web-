{% extends 'storefront/base/base.html' %}
{% load static %}

{% block title %}Mi Carrito de Compras{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-7xl">
    <h1 class="text-4xl font-extrabold text-gray-900 mb-8 border-b-4 border-indigo-500 pb-2">
        üõí Carrito de Compras
    </h1>

    {% with cart_data=cart.get_data %}
    {% if cart_data.items %}
    <div class="row">
        <!-- Columna Principal: Items del Carrito -->
        <div class="col-12 col-lg-8 mb-4">
            {% for item in cart_data.items %}
            <div class="card mb-3 shadow-sm">
                <div class="card-body d-flex flex-row align-items-center gap-3 flex-wrap">
                <!-- Imagen y Nombre del Producto -->
                <div class="d-flex align-items-center" style="width: 40%;">
                    <img src="{% if item.producto.imagen %}{{ item.producto.imagen.url }}{% else %}{% static 'img/placeholder.png' %}{% endif %}" 
                         alt="{{ item.producto.nombre }}" 
                         class="me-3" style="width: 80px; height: 80px; object-fit: contain;">
                    <div class="overflow-hidden">
                        <a href="{% url 'storefront:product' item.producto.slug %}" class="text-decoration-none">
                            <h5 class="mb-1 text-truncate">{{ item.producto.nombre }}</h5>
                        </a>
                        <p class="text-muted mb-0 small">SKU: {{ item.producto.sku }}</p>
                    </div>
                </div>

                <!-- Cantidad y Controles -->
                <div class="d-flex align-items-center gap-3 flex-fill justify-content-end">
                    <div class="input-group" style="width: 120px;">
                        <span class="input-group-text">Cant.</span>
                        <input type="number" 
                               class="form-control text-center cart-quantity-input"
                               value="{{ item.cantidad }}" 
                               min="1" 
                               max="{{ item.producto.stock }}"
                               data-product-id="{{ item.producto.id }}">
                    </div>

                    <!-- Subtotal -->
                    <div class="text-end" style="min-width: 100px;">
                        <small class="text-muted d-block">Subtotal</small>
                        <span class="h5 mb-0">${{ item.subtotal|floatformat:2 }}</span>
                    </div>
                    
                    <!-- Bot√≥n Eliminar -->
                    <button class="btn btn-outline-danger cart-remove-item" 
                            data-product-id="{{ item.producto.id }}"
                            title="Eliminar">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <!-- Columna Lateral: Resumen de Compra -->
        <div class="col-12 col-lg-4">
            <div class="card sticky-top" style="top: 1rem;">
                <div class="card-body">
                    <h4 class="card-title mb-4 pb-2 border-bottom">Resumen de Compra</h4>
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-2">
                            <span>Items ({{ cart_data.total_items }}):</span>
                            <span>${{ cart_data.subtotal|floatformat:2 }}</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Env√≠o:</span>
                            <span class="text-success">GRATIS</span>
                        </div>
                        <div class="d-flex justify-content-between pt-2 border-top">
                            <span class="h5">Total:</span>
                            <span class="h4 text-primary">${{ cart_data.total|floatformat:2 }}</span>
                        </div>
                    </div>

                    <a href="{% url 'storefront:checkout' %}" class="btn btn-primary btn-lg w-100 mb-2">
                        Finalizar Compra
                    </a>
                    <a href="{% url 'storefront:products' %}" class="btn btn-outline-secondary w-100">
                        Continuar Comprando
                    </a>
                </div>
            </div>
        </div>
    </div>

    {% else %}
    <!-- Estado: Carrito Vac√≠o -->
    <div class="card text-center p-5">
        <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-16 w-16 text-indigo-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
        </svg>
        <h2 class="mt-4 text-xl font-semibold text-gray-900">Tu carrito est√° vac√≠o</h2>
        <p class="mt-2 text-gray-500">Parece que a√∫n no has agregado ning√∫n producto. ¬°Explora nuestro cat√°logo!</p>
        <a href="{% url 'storefront:products' %}" class="mt-6 inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-xl shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 transition duration-200">
            Ver Productos
        </a>
    </div>
    {% endif %}
    {% endwith %}

</div>
{% endblock %}
